<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Auto Vergleichsrechner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CSS √ºber CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-900">

  <div class="relative w-full max-w-6xl mx-auto px-4 py-10 flex flex-col items-center">

    <!-- Porsche Silhouette im Hintergrund -->
    <div class="pointer-events-none absolute inset-x-0 top-24 -z-10">
      <svg class="w-full opacity-10" viewBox="0 0 1800 320" xmlns="http://www.w3.org/2000/svg">
        <!-- Bodenlinie -->
        <rect x="80" y="230" width="1640" height="8" rx="4" fill="#0f172a" opacity="0.14" />
        <!-- Silhouette (vereinfacht 911-artig) -->
        <path
          d="M120 225
             C260 175 430 150 620 145
             L720 142
             C820 120 930 110 1040 112
             C1160 115 1250 130 1340 155
             C1430 180 1520 210 1640 225"
          fill="none"
          stroke="#0f172a"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </div>

    <!-- Header -->
    <header class="w-full flex flex-col md:flex-row md:items-center md:justify-between mb-10">
      <div>
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">
          Fahrzeug Vergleich
        </h1>
        <p class="text-slate-500 mt-2">
          Eingeben. Analysieren. Sofort Marktbewertung erhalten.
        </p>
      </div>
      <div class="mt-4 md:mt-0 text-xs md:text-sm text-slate-400">
        Vergleichsrechner ‚Ä¢ Marktanalyse ‚Ä¢ Preisbewertung
      </div>
    </header>

    <!-- Karte mit Eingabeformular -->
    <section class="w-full bg-white/90 backdrop-blur border border-slate-200 rounded-3xl shadow-xl shadow-slate-200/70 p-6 md:p-8">
      <form id="search-form" class="space-y-4">

        <!-- Modell -->
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">
            Modell (z. B. Porsche 997, Golf 7 GTD, Audi A3)
          </label>
          <input
            id="model"
            type="text"
            required
            placeholder="Audi A3"
            class="w-full rounded-xl bg-white border border-slate-300 px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
          />
        </div>

        <!-- Zeile: EZ, km, PS -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Erstzulassung ab</label>
            <input
              id="year"
              type="number"
              min="1950"
              max="2100"
              placeholder="2008"
              class="w-full rounded-xl bg-white border border-slate-300 px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Max. Kilometer</label>
            <input
              id="km"
              type="number"
              min="0"
              placeholder="160000"
              class="w-full rounded-xl bg-white border border-slate-300 px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Min. Leistung (PS)</label>
            <input
              id="ps"
              type="number"
              min="0"
              placeholder="320"
              class="w-full rounded-xl bg-white border border-slate-300 px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            />
          </div>
        </div>

        <!-- Zeile: Kraftstoff / Getriebe / Besch√§digt -->
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Kraftstoff</label>
            <select
              id="fuel"
              class="w-full rounded-xl bg-white border border-slate-300 px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            >
              <option value="">Alle</option>
              <option value="PETROL">Benzin</option>
              <option value="DIESEL">Diesel</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Getriebe</label>
            <select
              id="gearbox"
              class="w-full rounded-xl bg-white border border-slate-300 px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            >
              <option value="">Alle</option>
              <option value="AUTO">Automatik</option>
              <option value="SEMIAUTO">Halbautomatik</option>
              <option value="AUTO_SEMIAUTO">Automatik + Halbautomatik</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Besch√§digte anzeigen?</label>
            <select
              id="damaged"
              class="w-full rounded-xl bg-white border border-slate-300 px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            >
              <option value="false">Nein</option>
              <option value="true">Ja</option>
            </select>
          </div>
        </div>

        <!-- Submit-Button -->
        <button
          type="submit"
          class="w-full mt-2 bg-slate-900 text-white py-3 rounded-xl font-semibold text-sm md:text-base hover:bg-slate-800 active:bg-slate-900 transition shadow-md shadow-slate-500/30"
        >
          Fahrzeug-Suche starten
        </button>
      </form>

      <!-- Portal-Buttons -->
      <div id="portal-links" class="hidden mt-6 flex flex-col md:flex-row gap-4">
        <a
          id="btn-mobile"
          target="_blank"
          class="flex-1 text-center bg-blue-600 text-white py-3 rounded-xl font-semibold text-sm md:text-base hover:bg-blue-700 transition"
        >
          mobile.de √∂ffnen
        </a>
        <a
          id="btn-autoscout"
          target="_blank"
          class="flex-1 text-center bg-amber-500 text-white py-3 rounded-xl font-semibold text-sm md:text-base hover:bg-amber-600 transition"
        >
          AutoScout24 √∂ffnen (demn√§chst)
        </a>
        <a
          id="btn-kleinanzeigen"
          target="_blank"
          class="flex-1 text-center bg-emerald-600 text-white py-3 rounded-xl font-semibold text-sm md:text-base hover:bg-emerald-700 transition"
        >
          Kleinanzeigen √∂ffnen (demn√§chst)
        </a>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-10 text-xs text-slate-400 text-center">
      Auto Vergleichsrechner ‚Äì Beta Version<br />
      Nur zur privaten Nutzung.
    </footer>
  </div>

  <!-- JavaScript -->
  <script>
    // Hilfsfunktion: PS ‚Üí kW (mobile.de nutzt kW)
    function psToKw(ps) {
      if (!ps) return null;
      const n = Number(ps);
      if (Number.isNaN(n) || n <= 0) return null;
      // 1 PS ‚âà 0.7355 kW
      return Math.round(n * 0.7355);
    }

    function buildMobileUrl(filters) {
  const url = new URL("https://suchen.mobile.de/fahrzeuge/search.html");
  const p = url.searchParams;

  // Basis
  p.set("isSearchRequest", "true");
  p.set("ref", "dsp");
  p.set("s", "Car");
  p.set("vc", "Car");
  p.set("sb", "p");
  p.set("cn", "DE");
  p.set("dam", filters.damaged === "true" ? "true" : "false");

  // -----------------------------
  // üîç Hersteller- & Modell-Erkennung
  // -----------------------------
  const MODELS = [
    { brand: "audi", model: "a3", makeId: "1900", modelId: "8" },
    { brand: "audi", model: "a4", makeId: "1900", modelId: "9" },
    { brand: "vw", model: "golf", makeId: "25200", modelId: "1" },
    { brand: "porsche", model: "997", makeId: "20100", modelId: "27" },
    { brand: "bmw", model: "320", makeId: "3500", modelId: "13" }
  ];

  let input = (filters.model || "").toLowerCase();

  let detected = MODELS.find(m =>
    input.includes(m.brand) && input.includes(m.model)
  );

  if (!detected) {
    // Falls nur Modell eingegeben wurde (z. B. "997")
    detected = MODELS.find(m => input.includes(m.model));
  }

  if (detected) {
    // ECHTER Mobile.de Modellfilter:
    p.set("ms", `${detected.makeId};${detected.modelId};`);
  } else {
    // Fallback: Freitextsuche
    p.set("q", filters.model.trim());
  }

  // -----------------------------
  // EZ
  // -----------------------------
  if (filters.year) {
    const y = parseInt(filters.year, 10);
    if (!Number.isNaN(y)) p.set("fr", String(y));
  }

  // Kilometer
  if (filters.km) {
    const km = parseInt(filters.km, 10);
    if (!Number.isNaN(km)) p.set("ml", ":" + String(km));
  }

  // Leistung PS ‚Üí kW
  if (filters.ps) {
    const kw = Math.round(filters.ps * 0.7355);
    p.set("pw", String(kw));
  }

  // Kraftstoff
  if (filters.fuel) p.set("ft", filters.fuel);

  // Getriebe
  if (filters.gearbox === "AUTO") p.append("tr", "AUTOMATIC_GEAR");
  if (filters.gearbox === "SEMIAUTO") p.append("tr", "SEMIAUTOMATIC_GEAR");
  if (filters.gearbox === "AUTO_SEMIAUTO") {
    p.append("tr", "AUTOMATIC_GEAR");
    p.append("tr", "SEMIAUTOMATIC_GEAR");
  }

  return url.toString();
}


    // Formular-Submit
    document.getElementById("search-form").addEventListener("submit", (e) => {
      e.preventDefault();

      const filters = {
        model:   document.getElementById("model").value,
        year:    document.getElementById("year").value,
        km:      document.getElementById("km").value,
        ps:      document.getElementById("ps").value,
        fuel:    document.getElementById("fuel").value,
        gearbox: document.getElementById("gearbox").value,
        damaged: document.getElementById("damaged").value
      };

      const mobileUrl = buildMobileUrl(filters);

      // mobile.de Link setzen
      document.getElementById("btn-mobile").href = mobileUrl;

      // Platzhalter-Links f√ºr die anderen Portale (sp√§ter implementieren)
      document.getElementById("btn-autoscout").href = "#";
      document.getElementById("btn-kleinanzeigen").href = "#";

      // Buttons sichtbar machen
      document.getElementById("portal-links").classList.remove("hidden");
    });
  </script>
</body>
</html>
